<!-- Initialize par default de simple_form pour bootstrap -->





# Use this setup block to configure all options available in SimpleForm.
SimpleForm.setup do |config|
  config.error_notification_class = 'alert alert-danger'
  config.button_class = 'btn btn-default'
  config.boolean_label_class = nil

  config.wrappers :vertical_form, tag: 'div', class: 'form-group', error_class: 'has-error' do |b|
    b.use :html5
    b.use :placeholder
    b.optional :maxlength
    b.optional :minlength
    b.optional :pattern
    b.optional :min_max
    b.optional :readonly
    b.use :label, class: 'control-label'

    b.use :input, class: 'form-control'
    b.use :error, wrap_with: { tag: 'span', class: 'help-block' }
    b.use :hint,  wrap_with: { tag: 'p', class: 'help-block' }
  end

  config.wrappers :vertical_file_input, tag: 'div', class: 'form-group', error_class: 'has-error' do |b|
    b.use :html5
    b.use :placeholder
    b.optional :maxlength
    b.optional :minlength
    b.optional :readonly
    b.use :label, class: 'control-label'

    b.use :input
    b.use :error, wrap_with: { tag: 'span', class: 'help-block' }
    b.use :hint,  wrap_with: { tag: 'p', class: 'help-block' }
  end

  config.wrappers :vertical_boolean, tag: 'div', class: 'form-group', error_class: 'has-error' do |b|
    b.use :html5
    b.optional :readonly

    b.wrapper tag: 'div', class: 'checkbox' do |ba|
      ba.use :label_input
    end

    b.use :error, wrap_with: { tag: 'span', class: 'help-block' }
    b.use :hint,  wrap_with: { tag: 'p', class: 'help-block' }
  end

  config.wrappers :vertical_radio_and_checkboxes, tag: 'div', class: 'form-group', error_class: 'has-error' do |b|
    b.use :html5
    b.optional :readonly
    b.use :label, class: 'control-label'
    b.use :input
    b.use :error, wrap_with: { tag: 'span', class: 'help-block' }
    b.use :hint,  wrap_with: { tag: 'p', class: 'help-block' }
  end

  config.wrappers :horizontal_form, tag: 'div', class: 'form-group', error_class: 'has-error' do |b|
    b.use :html5
    b.use :placeholder
    b.optional :maxlength
    b.optional :minlength
    b.optional :pattern
    b.optional :min_max
    b.optional :readonly
    b.use :label, class: 'col-sm-3 control-label'

    b.wrapper tag: 'div', class: 'col-sm-9' do |ba|
      ba.use :input, class: 'form-control'
      ba.use :error, wrap_with: { tag: 'span', class: 'help-block' }
      ba.use :hint,  wrap_with: { tag: 'p', class: 'help-block' }
    end
  end

  config.wrappers :horizontal_file_input, tag: 'div', class: 'form-group', error_class: 'has-error' do |b|
    b.use :html5
    b.use :placeholder
    b.optional :maxlength
    b.optional :minlength
    b.optional :readonly
    b.use :label, class: 'col-sm-3 control-label'

    b.wrapper tag: 'div', class: 'col-sm-9' do |ba|
      ba.use :input
      ba.use :error, wrap_with: { tag: 'span', class: 'help-block' }
      ba.use :hint,  wrap_with: { tag: 'p', class: 'help-block' }
    end
  end

  config.wrappers :horizontal_boolean, tag: 'div', class: 'form-group', error_class: 'has-error' do |b|
    b.use :html5
    b.optional :readonly

    b.wrapper tag: 'div', class: 'col-sm-offset-3 col-sm-9' do |wr|
      wr.wrapper tag: 'div', class: 'checkbox' do |ba|
        ba.use :label_input
      end

      wr.use :error, wrap_with: { tag: 'span', class: 'help-block' }
      wr.use :hint,  wrap_with: { tag: 'p', class: 'help-block' }
    end
  end

  config.wrappers :horizontal_radio_and_checkboxes, tag: 'div', class: 'form-group', error_class: 'has-error' do |b|
    b.use :html5
    b.optional :readonly

    b.use :label, class: 'col-sm-3 control-label'

    b.wrapper tag: 'div', class: 'col-sm-9' do |ba|
      ba.use :input
      ba.use :error, wrap_with: { tag: 'span', class: 'help-block' }
      ba.use :hint,  wrap_with: { tag: 'p', class: 'help-block' }
    end
  end

  config.wrappers :inline_form, tag: 'div', class: 'form-group', error_class: 'has-error' do |b|
    b.use :html5
    b.use :placeholder
    b.optional :maxlength
    b.optional :minlength
    b.optional :pattern
    b.optional :min_max
    b.optional :readonly
    b.use :label, class: 'sr-only'

    b.use :input, class: 'form-control'
    b.use :error, wrap_with: { tag: 'span', class: 'help-block' }
    b.use :hint,  wrap_with: { tag: 'p', class: 'help-block' }
  end

  config.wrappers :multi_select, tag: 'div', class: 'form-group', error_class: 'has-error' do |b|
    b.use :html5
    b.optional :readonly
    b.use :label, class: 'control-label'
    b.wrapper tag: 'div', class: 'form-inline' do |ba|
      ba.use :input, class: 'form-control'
      ba.use :error, wrap_with: { tag: 'span', class: 'help-block' }
      ba.use :hint,  wrap_with: { tag: 'p', class: 'help-block' }
    end
  end
  # Wrappers for forms and inputs using the Bootstrap toolkit.
  # Check the Bootstrap docs (http://getbootstrap.com)
  # to learn about the different styles for forms and inputs,
  # buttons and other elements.
  config.default_wrapper = :vertical_form
  config.wrapper_mappings = {
    check_boxes: :vertical_radio_and_checkboxes,
    radio_buttons: :vertical_radio_and_checkboxes,
    file: :vertical_file_input,
    boolean: :vertical_boolean,
    datetime: :multi_select,
    date: :multi_select,
    time: :multi_select
  }
end

















<ul class="row list-unstyled">
                            <% @my_properties.each do |my_property| %>  
                            <li class="col-md-12">
                               <%= link_to my_property, class: "sans-text-decoration" do %>
                               <div class="card flex-md-row mb-4 box-shadow h-md-200">

                                <% if my_property.photos.attached? %>
                                <%= image_tag my_property.photos.first, class: " card-img-left card-img-left-md flex-auto d-block d-md-block box-shadow", alt: "my_property.title" %>
                                <% else %>
                                <p>ANNONCE SANS PHOTO</p>
                                <% end %>

                                <div class="card-body d-flex flex-column justify-content-center">
                                    <h3 class="text-dark">
                                        <%= truncate(strip_tags(my_property.title.capitalize), length: 25) %>
                                    </h3>
                                    <address class="text-secondary">
                                        <i class="fas fa-map-marker-alt"></i>&nbsp; <%= my_property.address %>, <%= my_property.city %>
                                    </address>
                                    <% if my_property.ad_type == "Vente" %>
                                    <p class="text-primary m-0 p-0 h3">
                                        <%= number_to_currency(my_property.price, precision: 0) %>
                                    </p>
                                    <% elsif my_property.ad_type == "Location" %>
                                    <p class="text-primary m-0 p-0 h3">
                                        <%= number_to_currency(my_property.price, precision: 0) %>/mois
                                    </p>
                                    <% end %>

                                    <div class="row">
                                        <div class="col-lg-4">
                                            <%= link_to 'Voir', my_property, class: "" %>
                                        </div>
                                        <div class="col-lg-4">
                                            <%= link_to "Modifier", edit_property_path(my_property), class: "" %>
                                        </div>
                                        <div class="col-lg-4">
                                            <%= link_to 'Supprimer', my_property_path(my_property.id), method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-secondary sr-only" %>
                                        </div>
                                    </div>

                                </div>
                                </div>
                                <% end %>
                            </li>
                            <% end %>
                        </ul> 












                        <div class="row featurette bg-white">
                            <div class="col-md-6 px-0">
                                <% if my_property.photos.attached? %>
                                <%= image_tag my_property.photos.first, class: "px-0 w-100 h-100 pl-0", alt: "Photo de lannonce : #{ my_property.title }" %>
                                <% else %>
                                <p>ANNONCE SANS PHOTO</p>
                                <% end %>
                            </div>
                            <div class="col-md-6 d-flex flex-column justify-content-center">
                                <h3><%= truncate(strip_tags(my_property.title.capitalize), length: 25) %></h3>
                                <address class="text-secondary">
                                    <i class="fas fa-map-marker-alt"></i>&nbsp; <%= my_property.address %>, <%= my_property.city %>
                                </address>
                                <% if my_property.ad_type == "Vente" %>
                                <p>
                                    <span><%= sprintf("%0.00f", my_property.price) %><sup>F</sup></span>
                                </p>
                                <% elsif my_property.ad_type == "Location" %>
                                <p class="h2 text-primary">
                                    <span><%= sprintf("%0.00f", my_property.price) %><sup>F</sup><small>/mois</small></span>
                                </p>
                                <% end %>
                            </div>
                        </div>

                        

<!-- Product listing design -->


                <ul class="list-unstyled col-12">
                    <% @my_properties.each do |my_property| %>

<div class="row featurette bg-white">
    <div class="col-md-6 order-md-2">
        <h2 class="featurette-heading">Oh yeah, it's that good. <span class="text-muted">See for yourself.</span></h2>
        <p class="lead">Donec ullamcorper nulla non metus auctor fringilla. Vestibulum id ligula porta felis euismod semper. Praesent commodo cursus magna, vel scelerisque nisl consectetur. Fusce dapibus, tellus ac cursus commodo.</p>
    </div>
    <div class="col-md-6 order-md-1">
        <% if my_property.photos.attached? %>
            <%= image_tag my_property.photos.first, class: "featurette-image img-fluid mx-auto w-100 h-100 pl-0", alt: "Photo de lannonce : #{ my_property.title }" %>
        <% else %>
            <p>ANNONCE SANS PHOTO</p>
        <% end %>
    </div>
</div>





                    <li class="row d-flex align-items-center">
                        <div class="col-lg-3">
                            <% if my_property.photos.attached? %>
                                <%= image_tag my_property.photos.first, class: "img-fluid w-100 h-100", alt: "Photo de lannonce : #{ my_property.title }" %>
                            <% else %>
                                <p>ANNONCE SANS PHOTO</p>
                            <% end %>
                        </div>
                        <div class="col-lg-6 py-3 d-flex flex-column justify-content-center">
                            <h5><%= truncate(strip_tags(my_property.title.capitalize), length: 25) %></h5>
                            <address class="">
                                <i class="fas fa-map-marker-alt"></i>&nbsp; <%= my_property.address %>, <%= my_property.city %>
                            </address>
                            <% if my_property.ad_type == "A vendre" %>
                            <p>
                                <span><%= sprintf("%0.00f", my_property.price) %><sup>F</sup></span>
                            </p>
                            <% elsif my_property.ad_type == "A louer" %>
                            <p>
                                <span><%= sprintf("%0.00f", my_property.price) %><sup>F</sup><small>/mois</small></span>
                            </p>
                            <% end %>
                        </div>
                        <div class="col-lg-3">
                            <div class="btn-group" role="group", aria-label="">
                                <%= link_to 'Voir', my_property, class: "btn btn-secondary" %>
                                <%= link_to "Modifier", edit_property_path(my_property), class: "btn btn-secondary" %>
                                <%= link_to 'Supprimer', my_property_path(my_property.id), method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-secondary sr-only" %>
                            </div>
                        </div>
                    </li>
                    <hr>
                    <% end %>
                </ul>











                <% if current_page?(home_page_path) %>
<%= simple_form_for "", url: properties_path, method: :get do |f| %>
<div class="row px-1">
    <div class="col-lg-3 px-1">
        <%= f.input :property_type, collection: Property::PROPERTYTYPE, required: true, input_html: { class: "form-control form-control-lg" }, label: false, wrapper: false %>
    </div>
    <div class="col-lg-3 px-1">
        <%= f.input :ad_type, collection: Property::ADTYPE, required: true, input_html: { class: "form-control form-control-lg" }, label: false, wrapper: false %>
    </div>
    <div class="col-lg-4 px-1">
        <%= f.input :city, placeholder: "Ou ? Example: Zogbo, Fifadji, etc...", input_html: { class: "form-control form-control-lg" }, label: false, wrapper: false %>
    </div>
    <div class="col-lg-2 px-1">
        <%= f.button :submit, "Rechercher", name: nil, class: 'btn btn-primary btn-block btn-lg' %>
    </div>
</div>

<% end %>

<%= form_with url: properties_path, method: :get, local: true do |form| %>
<div class="form-row px-1">
    <div class="col-lg-3 my-1">
        <%= form.select :property_type, PropertyType.all.collect { |p| [ p.name, p.id ] }, { include_blank: "Type de bien" }, { class: "form-control form-control-lg", required: true } %>
    </div>
    <div class="col-lg-3 my-1">
        <%= form.select :ad_type, AdType.all.collect { |p| [ p.name, p.id ] }, { include_blank: "Type d'annonce" }, { class: "form-control form-control-lg", required: true } %>
    </div>
    <div class="col-lg-4 my-1">
        <%= form.search_field :city, placeholder: "Ou ? Example: Zogbo, Fifadji, etc...", class: 'form-control form-control-lg' %>
    </div>
    <div class="col-lg-2 my-1">
        <%= form.submit "Rechercher", name: nil, class: 'btn btn-primary btn-block btn-lg' %>
    </div>
</div>
<% end %>
<% elsif current_page?(controller: "properties", action: "index")%>
<%= form_with url: properties_path, method: :get, local: true do |form| %>
<div class="form-row px-1">
    <div class="col-lg-4 my-1">
        <%= form.select :property_type, PropertyType.all.collect { |p| [ p.name, p.id ] }, { prompt: "Type de bien" }, { class: "form-control", required: true } %>
    </div>
    <div class="col-lg-4 my-1">
        <%= form.select :ad_type, AdType.all.collect { |p| [ p.name, p.id ] }, { prompt: "Type d'annonce" }, { class: "form-control", required: true } %>
    </div>
    <div class="col-lg-4 my-1">
        <%= form.text_field :city, placeholder: "Ou ? Example: Zogbo, Fifadji, Ste Rita etc...", class: 'form-control' %>
    </div>
    <div class="col-lg-3 my-1">
        <%= form.select :room, Property::ROOM, { prompt: "Nombres de pièce" }, class: "form-control" %>
    </div>    
    <div class="col-lg-2 my-1">
        <%= form.number_field :loyer_minimum, placeholder: "Loyer minimum", class: 'form-control' %>
    </div>
    <div class="col-lg-2 my-1">
        <%= form.number_field :loyer_maximum, placeholder: "Loyer maximum", class: 'form-control' %>
    </div>
    <div class="col-lg-2 my-1">
        <%= form.number_field :surface_minimum, placeholder: "Surface minimum", class: 'form-control' %>
    </div>
    <div class="col-lg-3 my-1">
        <%= form.submit "Rechercher", name: nil, class: 'btn btn-primary btn btn-block' %>
    </div>
</div>
<% end %>
<% end %>



create_table "properties", force: :cascade do |t|
    t.string "title"
    t.decimal "price", precision: 10, scale: 2
    t.integer "area"
    t.text "description"
    t.string "address"
    t.string "city"
    t.float "latitude"
    t.float "longitude"
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.integer "user_id"
    t.string "slug"
    t.string "room"
    t.boolean "available"
    t.boolean "published", default: false
    t.integer "avance"
    t.string "feature", array: true
    t.string "etage"
    t.string "travaux"
    t.datetime "published_at"
    t.string "commune"
    t.string "property_type"
    t.string "ad_type"
    t.index ["slug"], name: "index_properties_on_slug", unique: true
    t.index ["user_id"], name: "index_properties_on_user_id"
  end



  def index
        if user_signed_in?
            if current_user.admin?
                @properties = Property.all.order("created_at DESC").page(params[:page]).per(6)
                @properties_numbers = @properties.count
            else
                if params[:property_type].present? and params[:ad_type].present? and params[:city].present?
                    @properties = Property.where("property_type_id = ? AND ad_type_id = ? AND city LIKE ?", params[:property_type].to_i, params[:ad_type].to_i, "%#{params[:city]}%").all.order("created_at DESC").published.page(params[:page]).per(6)
                    @properties_numbers = @properties.count
                elsif params[:property_type].present? and params[:ad_type].present? and params[:city].blank?
                    @properties = Property.where("property_type_id = ? AND ad_type_id = ?", params[:property_type].to_i, params[:ad_type].to_i).all.order("created_at DESC").published.page(params[:page]).per(6)
                    @properties_numbers = @properties.count
                elsif params[:property_type].present?
                    @property_type_id = PropertyType.find_by(name: params[:property_type]).id
                    @properties = Property.where("property_type_id = ?", @property_type_id).all.order("created_at DESC").published.page(params[:page]).per(6)
                    @properties_numbers = @properties.count
                elsif params[:ad_type].present?
                    @ad_type_id = AdType.find_by(name: params[:ad_type]).id
                    @properties = Property.where("ad_type_id = ?", @ad_type_id).all.order("created_at DESC").published.page(params[:page]).per(6)
                    @properties_numbers = @properties.count
                else
                    @properties = Property.all.order("created_at DESC").published.page(params[:page]).per(6)
                    @properties_numbers = @properties.count
                end
            end
        else
            if params[:property_type].present? and params[:ad_type].present? and params[:city].blank? and params[:room].blank? and params[:surface_minimum].blank? and params[:loyer_minimum].blank? and params[:loyer_maximum].blank?
                @properties = Property.where("property_type_id = ? AND ad_type_id = ?", params[:property_type].to_i, params[:ad_type].to_i).all.order("created_at DESC").published.page(params[:page]).per(6)
                @properties_numbers = @properties.count
            elsif params[:property_type].present? and params[:ad_type].present? and params[:city].present? and params[:room].blank? and params[:surface_minimum].blank? and params[:loyer_minimum].blank? and params[:loyer_maximum].blank?
                @properties = Property.where("property_type_id = ? AND ad_type_id = ? AND city LIKE ?", params[:property_type].to_i, params[:ad_type].to_i, "%#{params[:city]}%").all.order("created_at DESC").published.page(params[:page]).per(6)
                @properties_numbers = @properties.count



            elsif params[:property_type].present? and params[:ad_type].present? and params[:city].present? and params[:room].blank? and params[:surface_minimum].present? and params[:loyer_minimum].present? and params[:loyer_maximum].present?
                @properties = Property.where("property_type_id = ? AND ad_type_id = ? AND city LIKE ? AND area >= ? AND price BETWEEN #{params[:loyer_minimum].to_i} AND #{params[:loyer_maximum].to_i}", params[:property_type].to_i, params[:ad_type].to_i, "%#{params[:city]}%", params[:surface_minimum].to_i).all.order("created_at DESC").published.page(params[:page]).per(6)
                @properties_numbers = @properties.count

            elsif params[:property_type].present? and params[:ad_type].present? and params[:city].present? and params[:room].blank? and params[:surface_minimum].present? and params[:loyer_minimum].blank? and params[:loyer_maximum].blank?
                @properties = Property.where("property_type_id = ? AND ad_type_id = ? AND city LIKE ? AND area >= ?", params[:property_type].to_i, params[:ad_type].to_i, "%#{params[:city]}%", params[:surface_minimum].to_i).all.order("created_at DESC").published.page(params[:page]).per(6)
                @properties_numbers = @properties.count

            elsif params[:property_type].present? and params[:ad_type].present? and params[:city].present? and params[:room].blank? and params[:surface_minimum].blank? and params[:loyer_minimum].present? and params[:loyer_maximum].present?
                @properties = Property.where("property_type_id = ? AND ad_type_id = ? AND city LIKE ? AND price BETWEEN #{params[:loyer_minimum].to_i} AND #{params[:loyer_maximum].to_i}", params[:property_type].to_i, params[:ad_type].to_i, "%#{params[:city]}%").all.order("created_at DESC").published.page(params[:page]).per(6)
                @properties_numbers = @properties.count

            elsif params[:property_type].present? and params[:ad_type].present? and params[:city].blank?
                @properties = Property.where("property_type_id = ? AND ad_type_id = ?", params[:property_type].to_i, params[:ad_type].to_i).all.order("created_at DESC").published.page(params[:page]).per(6)
                @properties_numbers = @properties.count
            elsif params[:property_type].present?
                @property_type_id = PropertyType.find_by(name: params[:property_type]).id
                @properties = Property.where("property_type_id = ?", @property_type_id).all.order("created_at DESC").published.page(params[:page]).per(6)
                @properties_numbers = @properties.count
            elsif params[:ad_type].present?
                @ad_type_id = AdType.find_by(name: params[:ad_type]).id
                @properties = Property.where("ad_type_id = ?", @ad_type_id).all.order("created_at DESC").published.page(params[:page]).per(6)
                @properties_numbers = @properties.count
            else
                @properties = Property.all.order("created_at DESC").published.page(params[:page]).per(6)
                @properties_numbers = @properties.count
            end
        end
    end